#!/usr/bin/env php
<?php

global $assign_to_config, $system_path, $debug, $CFG, $URI, $IN, $OUT, $LANG, $SEC, $loader;

require __DIR__.'/../vendor/autoload.php';

$assign_to_config = [];

$config = new eecli\Application\Config();

$bootstrapped = is_dir($config->getSystemPath());

if ($bootstrapped) {
    $system_path = $config->getSystemPath();

    require __DIR__.'/../src/bootstrap.php';
}

$app = new Symfony\Component\Console\Application('eecli', '0.0.0-alpha');

// add commands that don't require EE bootstrapped
$app->add(new eecli\Command\InitCommand());

if ($bootstrapped) {
    $app->addCommands([
        new eecli\Command\ClearStashCacheCommand(),
        new eecli\Command\ClearCeCacheCommand(),
        new eecli\Command\ClearEECacheCommand(),
        new eecli\Command\GithubAddonInstallerCommand(),
    ]);

    $config->addUserDefinedCommands($app);
} else {
    (new Symfony\Component\Console\Output\ConsoleOutput)->writeln("<error>******************************************\n*  Your system path could not be found.  *\n******************************************</error>\n");
}

$app->run();
